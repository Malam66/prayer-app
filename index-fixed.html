<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #4CAF50 100%);
            min-height: 100vh;
            color: white;
        }

        .status-bar {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Islamic Logo Section */
        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .geometric-pattern {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, transparent 0deg, #4CAF50 60deg, transparent 60deg, transparent 120deg, #4CAF50 120deg, transparent 120deg, transparent 180deg, #4CAF50 180deg, transparent 180deg, transparent 240deg, #4CAF50 240deg, transparent 240deg, transparent 300deg, #4CAF50 300deg, transparent 300deg, transparent 360deg);
            animation: rotate 15s linear infinite reverse;
        }

        .inner-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .calligraphy {
            font-size: 32px;
            color: #4CAF50;
            font-weight: bold;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .crescent {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            color: #FFD700;
        }

        .star {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 14px;
            color: #FFD700;
        }

        .app-title {
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .app-subtitle {
            color: #FFD700;
            font-size: 16px;
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .prayer-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.3);
        }

        .prayer-name {
            color: #FFD700;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .prayer-time {
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .current-time {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .time-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .time-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* Location Section */
        .location-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .location-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .location-button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .location-button:hover {
            transform: translateY(-2px);
        }

        .location-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .location-info {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .location-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            color: white;
        }

        .location-item:last-child {
            margin-bottom: 0;
        }

        .location-label {
            font-size: 14px;
            color: #FFD700;
        }

        .location-value {
            font-size: 16px;
            font-weight: bold;
        }

        .location-status {
            text-align: center;
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
        }

        .location-error {
            color: #ff6b6b;
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
        }

        .location-help {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .location-help-title {
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .location-help-text {
            color: white;
            font-size: 12px;
            opacity: 0.9;
        }

        /* Quran Section */
        .quran-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quran-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .quran-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .quran-search {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            color: white;
            font-size: 14px;
            width: 150px;
        }

        .quran-search::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .quran-chapters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quran-chapter {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .quran-chapter:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .chapter-number {
            color: #FFD700;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chapter-name {
            color: white;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .chapter-arabic {
            color: #FFD700;
            font-size: 12px;
            opacity: 0.9;
        }

        .quran-verse {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .verse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .verse-info {
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
        }

        .verse-actions {
            display: flex;
            gap: 10px;
        }

        .verse-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 5px 12px;
            color: #FFD700;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .verse-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        .verse-arabic {
            color: white;
            font-size: 18px;
            line-height: 1.8;
            text-align: right;
            margin-bottom: 15px;
            direction: rtl;
        }

        .verse-translation {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        .quran-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .quran-nav-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quran-nav-btn:hover {
            transform: translateY(-2px);
        }

        .quran-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ramadan-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ramadan-icon {
            font-size: 48px;
        }

        .ramadan-text {
            flex: 1;
        }

        .ramadan-title {
            color: #FFD700;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .ramadan-description {
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .product-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.3);
        }

        .product-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .product-name {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .navigation-bar {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            padding: 15px 20px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            transform: translateY(-2px);
            color: #FFD700;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .nav-text {
            font-size: 12px;
            font-weight: bold;
        }

        .nav-item.active {
            color: #FFD700;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .logo-container {
                width: 150px;
                height: 150px;
            }
            
            .logo-circle {
                width: 120px;
                height: 120px;
            }
            
            .geometric-pattern {
                width: 90px;
                height: 90px;
            }
            
            .inner-circle {
                width: 60px;
                height: 60px;
            }
            
            .calligraphy {
                font-size: 24px;
            }
            
            .app-title {
                font-size: 24px;
            }
        }

        /* Mosque Finder Section */
        .mosque-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .mosque-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .mosque-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .mosque-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mosque-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .mosque-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .mosque-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .location-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .location-btn:hover {
            background: linear-gradient(135deg, #1976D2, #1565C0);
        }

        .mosque-map-container {
            position: relative;
            height: 300px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .mosque-map {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            position: relative;
        }

        .mosque-map iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 15px;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
        }

        /* Mobile-specific improvements */
        @media (max-width: 768px) {
            .mosque-map-container {
                height: 250px;
                margin-bottom: 15px;
            }
            
            .mosque-map iframe {
                border-radius: 10px;
                -webkit-overflow-scrolling: touch;
                touch-action: manipulation;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }
            
            .mosque-map-placeholder {
                border-radius: 10px;
                padding: 20px;
            }
            
            .location-status {
                top: 10px;
                right: 10px;
                left: 10px;
                font-size: 11px;
                padding: 8px 12px;
                z-index: 1001;
            }
            
            /* Enhanced mobile touch handling */
            .mosque-btn, .location-btn {
                min-height: 44px;
                padding: 12px 20px;
                font-size: 16px;
                -webkit-tap-highlight-color: transparent;
            }
            
            .mosque-buttons {
                gap: 8px;
            }
            
            /* Mobile-specific map container */
            .mosque-map {
                -webkit-overflow-scrolling: touch;
                touch-action: manipulation;
            }
            
            /* Mobile fallback map styles */
            #mobile-fallback-map {
                -webkit-overflow-scrolling: touch;
                touch-action: manipulation;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }
            
            #mobile-fallback-map button {
                -webkit-tap-highlight-color: transparent;
                transition: all 0.3s ease;
            }
            
            #mobile-fallback-map button:active {
                transform: scale(0.95);
            }
        }
        
        /* iOS-specific improvements */
        @media (max-width: 768px) and (-webkit-min-device-pixel-ratio: 2) {
            .mosque-map iframe {
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
            }
            
            #mobile-fallback-map {
                -webkit-transform: translateZ(0);
                transform: translateZ(0);
            }
        }

        .mosque-map-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            text-align: center;
            border-radius: 15px;
        }

        .mosque-map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
        }

        .location-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }

        .location-status.success {
            background: rgba(76, 175, 80, 0.9);
        }

        .location-status.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .mosque-map-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .mosque-map-description {
            font-size: 14px;
            opacity: 0.9;
        }

        .mosque-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .mosque-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .mosque-list-title {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .mosque-list-count {
            color: #FFD700;
            font-size: 14px;
        }

        .mosque-items {
            max-height: 300px;
            overflow-y: auto;
        }

        .mosque-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .mosque-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .mosque-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .mosque-name {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .mosque-distance {
            color: #FFD700;
            font-size: 14px;
        }

        .mosque-details {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            line-height: 1.4;
        }

        .mosque-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mosque-action-btn {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 5px 12px;
            color: #FFD700;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mosque-action-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        .mosque-help {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .mosque-help-title {
            color: #FFD700;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .mosque-help-text {
            color: white;
            font-size: 12px;
            opacity: 0.9;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <div class="status-left">
            <span>üì±</span>
            <span>Prayer App</span>
        </div>
        <div class="status-right">
            <span>üì∂</span>
            <span>100%</span>
            <span>üîã</span>
        </div>
    </div>

    <div class="content">
        <!-- Location Status Indicator -->
        <div id="locationStatus" class="location-status"></div>
        
        <!-- Islamic Logo Section -->
        <div class="logo-section">
            <div class="logo-container">
                <div class="logo-circle">
                    <div class="geometric-pattern"></div>
                    <div class="inner-circle">
                        <div class="calligraphy">‚ò™Ô∏è</div>
                    </div>
                    <div class="crescent">üåô</div>
                    <div class="star">‚≠ê</div>
                </div>
            </div>
            <div class="app-title">Prayer App</div>
            <div class="app-subtitle">Islamic Prayer Times & Qibla</div>
        </div>

        <!-- Prayer Times Section -->
        <div class="section">
            <div class="section-title">Prayer Times</div>
            
            <div class="current-time">
                <div class="time-label">Current Time</div>
                <div class="time-value" id="current-time">--:--</div>
            </div>

            <div class="prayer-grid">
                <div class="prayer-card">
                    <div class="prayer-name">Fajr</div>
                    <div class="prayer-time">5:30 AM</div>
                </div>
                <div class="prayer-card">
                    <div class="prayer-name">Dhuhr</div>
                    <div class="prayer-time">12:30 PM</div>
                </div>
                <div class="prayer-card">
                    <div class="prayer-name">Asr</div>
                    <div class="prayer-time">3:45 PM</div>
                </div>
                <div class="prayer-card">
                    <div class="prayer-name">Maghrib</div>
                    <div class="prayer-time">6:15 PM</div>
                </div>
                <div class="prayer-card">
                    <div class="prayer-name">Isha</div>
                    <div class="prayer-time">7:45 PM</div>
                </div>
            </div>
        </div>

        <!-- Location Section -->
        <div class="section">
            <div class="location-header">
                <div class="location-title">üìç Live Location</div>
                <button class="location-button" id="get-location-btn">Get Location</button>
            </div>
            
            <div class="location-info" id="location-info" style="display: none;">
                <div class="location-item">
                    <span class="location-label">City:</span>
                    <span class="location-value" id="city">--</span>
                </div>
                <div class="location-item">
                    <span class="location-label">Country:</span>
                    <span class="location-value" id="country">--</span>
                </div>
                <div class="location-item">
                    <span class="location-label">Latitude:</span>
                    <span class="location-value" id="latitude">--</span>
                </div>
                <div class="location-item">
                    <span class="location-label">Longitude:</span>
                    <span class="location-value" id="longitude">--</span>
                </div>
                <div class="location-item">
                    <span class="location-label">Accuracy:</span>
                    <span class="location-value" id="accuracy">--</span>
                </div>
            </div>
            
            <div class="location-status" id="location-status"></div>
            <div class="location-error" id="location-error"></div>
            
                         <div class="location-help">
                 <div class="location-help-title">üí° Location Help (Target: 50m accuracy)</div>
                 <div class="location-help-text">
                     ‚Ä¢ Click "Get Location" to use your device's GPS<br>
                     ‚Ä¢ Allow location access when prompted by your browser<br>
                     ‚Ä¢ For 50m accuracy: Go outside or near windows<br>
                     ‚Ä¢ Make sure you have an internet connection<br>
                     ‚Ä¢ Wait 10-30 seconds for GPS to lock properly<br>
                     ‚Ä¢ GPS works best in open areas with clear sky view<br>
                     ‚Ä¢ Avoid tall buildings and underground locations<br>
                     ‚Ä¢ The app will try multiple methods for best accuracy
                 </div>
             </div>
        </div>

        <!-- Ramadan Section -->
        <div class="section">
            <div class="ramadan-content">
                <div class="ramadan-icon">üïå</div>
                <div class="ramadan-text">
                    <div class="ramadan-title">Ramadan Mubarak</div>
                    <div class="ramadan-description">Blessed month of fasting and prayer</div>
                </div>
            </div>
        </div>

        <!-- Quran Section -->
        <div class="quran-section">
            <div class="quran-header">
                <div class="quran-title">üìñ Holy Quran</div>
                <input type="text" class="quran-search" placeholder="Search chapters..." id="quran-search">
            </div>
            
            <div class="quran-chapters" id="quran-chapters">
                <div class="quran-chapter" data-chapter="1">
                    <div class="chapter-number">1</div>
                    <div class="chapter-name">Al-Fatiha</div>
                    <div class="chapter-arabic">ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©</div>
                </div>
                <div class="quran-chapter" data-chapter="2">
                    <div class="chapter-number">2</div>
                    <div class="chapter-name">Al-Baqarah</div>
                    <div class="chapter-arabic">ÿßŸÑÿ®ŸÇÿ±ÿ©</div>
                </div>
                <div class="quran-chapter" data-chapter="3">
                    <div class="chapter-number">3</div>
                    <div class="chapter-name">Aal-Imran</div>
                    <div class="chapter-arabic">ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ</div>
                </div>
                <div class="quran-chapter" data-chapter="4">
                    <div class="chapter-number">4</div>
                    <div class="chapter-name">An-Nisa</div>
                    <div class="chapter-arabic">ÿßŸÑŸÜÿ≥ÿßÿ°</div>
                </div>
                <div class="quran-chapter" data-chapter="5">
                    <div class="chapter-number">5</div>
                    <div class="chapter-name">Al-Ma'idah</div>
                    <div class="chapter-arabic">ÿßŸÑŸÖÿßÿ¶ÿØÿ©</div>
                </div>
                <div class="quran-chapter" data-chapter="6">
                    <div class="chapter-number">6</div>
                    <div class="chapter-name">Al-An'am</div>
                    <div class="chapter-arabic">ÿßŸÑÿ£ŸÜÿπÿßŸÖ</div>
                </div>
                <div class="quran-chapter" data-chapter="7">
                    <div class="chapter-number">7</div>
                    <div class="chapter-name">Al-A'raf</div>
                    <div class="chapter-arabic">ÿßŸÑÿ£ÿπÿ±ÿßŸÅ</div>
                </div>
                <div class="quran-chapter" data-chapter="8">
                    <div class="chapter-number">8</div>
                    <div class="chapter-name">Al-Anfal</div>
                    <div class="chapter-arabic">ÿßŸÑÿ£ŸÜŸÅÿßŸÑ</div>
                </div>
                <div class="quran-chapter" data-chapter="9">
                    <div class="chapter-number">9</div>
                    <div class="chapter-name">At-Tawbah</div>
                    <div class="chapter-arabic">ÿßŸÑÿ™Ÿàÿ®ÿ©</div>
                </div>
                <div class="quran-chapter" data-chapter="10">
                    <div class="chapter-number">10</div>
                    <div class="chapter-name">Yunus</div>
                    <div class="chapter-arabic">ŸäŸàŸÜÿ≥</div>
                </div>
                <div class="quran-chapter" data-chapter="36">
                    <div class="chapter-number">36</div>
                    <div class="chapter-name">Ya-Sin</div>
                    <div class="chapter-arabic">Ÿäÿ≥</div>
                </div>
                <div class="quran-chapter" data-chapter="55">
                    <div class="chapter-number">55</div>
                    <div class="chapter-name">Ar-Rahman</div>
                    <div class="chapter-arabic">ÿßŸÑÿ±ÿ≠ŸÖŸÜ</div>
                </div>
                <div class="quran-chapter" data-chapter="67">
                    <div class="chapter-number">67</div>
                    <div class="chapter-name">Al-Mulk</div>
                    <div class="chapter-arabic">ÿßŸÑŸÖŸÑŸÉ</div>
                </div>
                <div class="quran-chapter" data-chapter="112">
                    <div class="chapter-number">112</div>
                    <div class="chapter-name">Al-Ikhlas</div>
                    <div class="chapter-arabic">ÿßŸÑÿ•ÿÆŸÑÿßÿµ</div>
                </div>
                <div class="quran-chapter" data-chapter="113">
                    <div class="chapter-number">113</div>
                    <div class="chapter-name">Al-Falaq</div>
                    <div class="chapter-arabic">ÿßŸÑŸÅŸÑŸÇ</div>
                </div>
                <div class="quran-chapter" data-chapter="114">
                    <div class="chapter-number">114</div>
                    <div class="chapter-name">An-Nas</div>
                    <div class="chapter-arabic">ÿßŸÑŸÜÿßÿ≥</div>
                </div>
            </div>
            
            <div id="quran-verses" style="display: none;">
                <div class="quran-verse">
                    <div class="verse-header">
                        <div class="verse-info">Surah Al-Fatiha - Verse 1</div>
                        <div class="verse-actions">
                            <button class="verse-btn">üîä Audio</button>
                            <button class="verse-btn">‚ù§Ô∏è Bookmark</button>
                        </div>
                    </div>
                    <div class="verse-arabic">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</div>
                    <div class="verse-translation">In the name of Allah, the Entirely Merciful, the Especially Merciful.</div>
                </div>
                
                <div class="quran-verse">
                    <div class="verse-header">
                        <div class="verse-info">Surah Al-Fatiha - Verse 2</div>
                        <div class="verse-actions">
                            <button class="verse-btn">üîä Audio</button>
                            <button class="verse-btn">‚ù§Ô∏è Bookmark</button>
                        </div>
                    </div>
                    <div class="verse-arabic">ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê ÿ±Ÿéÿ®ŸêŸë ÿßŸÑŸíÿπŸéÿßŸÑŸéŸÖŸêŸäŸÜŸé</div>
                    <div class="verse-translation">[All] praise is [due] to Allah, Lord of the worlds.</div>
                </div>
                
                <div class="quran-verse">
                    <div class="verse-header">
                        <div class="verse-info">Surah Al-Fatiha - Verse 3</div>
                        <div class="verse-actions">
                            <button class="verse-btn">üîä Audio</button>
                            <button class="verse-btn">‚ù§Ô∏è Bookmark</button>
                        </div>
                    </div>
                    <div class="verse-arabic">ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</div>
                    <div class="verse-translation">The Entirely Merciful, the Especially Merciful.</div>
                </div>
                
                <div class="quran-nav">
                    <button class="quran-nav-btn" id="prev-verse">‚Üê Previous</button>
                    <button class="quran-nav-btn" id="next-verse">Next ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div class="section">
            <div class="section-title">Islamic Products</div>
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-icon">üìø</div>
                    <div class="product-name">Prayer Beads</div>
                </div>
                <div class="product-card">
                    <div class="product-icon">üïå</div>
                    <div class="product-name">Prayer Mat</div>
                </div>
                <div class="product-card">
                    <div class="product-icon">üìñ</div>
                    <div class="product-name">Quran</div>
                </div>
                <div class="product-card">
                    <div class="product-icon">üïØÔ∏è</div>
                    <div class="product-name">Incense</div>
                </div>
            </div>
        </div>

        <!-- Mosque Finder Section -->
        <div class="mosque-section">
            <div class="mosque-header">
                <div class="mosque-title">üïå Find Nearby Mosques</div>
                <div class="mosque-buttons">
                    <button class="mosque-btn" id="find-mosques-btn">üîç Find Mosques</button>
                    <button class="mosque-btn location-btn" id="show-location-btn" onclick="showUserLocation()">üìç Show My Location</button>
                </div>
            </div>
            
                                        <div class="mosque-map-container">
                                <div id="mosque-map" class="mosque-map">
                                    <div class="mosque-map-placeholder" id="map-placeholder">
                                        <div>
                                            <div style="font-size: 24px; margin-bottom: 10px;">üó∫Ô∏è</div>
                                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">Interactive Mosque Map</div>
                                            <div style="font-size: 14px; opacity: 0.8;">Click "Find Mosques" to load the map</div>
                                        </div>
                                    </div>
                                    <iframe id="map-iframe" style="display: none;" frameborder="0" allowfullscreen="true" allow="geolocation; microphone; camera" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation" loading="lazy"></iframe>
                                </div>
                                <div class="mosque-map-overlay">
                                    <div class="mosque-map-info">
                                        <div class="mosque-map-title">Mosque Finder</div>
                                        <div class="mosque-map-description">Click "Find Mosques" to discover nearby Islamic centers and mosques</div>
                                    </div>
                                </div>
                            </div>
            
            <div class="mosque-list" id="mosque-list">
                <div class="mosque-list-header">
                    <div class="mosque-list-title">Nearby Mosques</div>
                    <div class="mosque-list-count" id="mosque-count">0 found</div>
                </div>
                <div class="mosque-items" id="mosque-items">
                    <!-- Mosque items will be added here -->
                </div>
            </div>
            
            <div class="mosque-help">
                <div class="mosque-help-title">üí° Mosque Finder Help</div>
                <div class="mosque-help-text">
                    ‚Ä¢ Click "Find Mosques" to search for real mosques near your location<br>
                    ‚Ä¢ Uses OpenStreetMap data to find actual mosques, masjids, and Islamic centers<br>
                    ‚Ä¢ Your location will be shown as a blue pin on the map<br>
                    ‚Ä¢ Click "Show My Location" to center the map on your position<br>
                    ‚Ä¢ Results show real mosques within 5km of your location<br>
                    ‚Ä¢ Each mosque shows actual distance, rating, and contact info<br>
                    ‚Ä¢ Use the map to see exact locations and get directions<br>
                    ‚Ä¢ üì± Mobile users: Enhanced mobile map with fallback options<br>
                    ‚Ä¢ üì± Mobile users: If map doesn't load, a fallback button will appear<br>
                    ‚Ä¢ üì± Mobile users: Tap "Open Mobile Map" to view in your browser<br>
                    ‚Ä¢ Global location is used consistently for all nearby mosque displays<br>
                    ‚Ä¢ If no real mosques found, nearby mosques will be generated based on your location
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <div class="navigation-bar">
        <div class="nav-item active">
            <div class="nav-icon">üè†</div>
            <div class="nav-text">Home</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">üïê</div>
            <div class="nav-text">Prayer</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">üß≠</div>
            <div class="nav-text">Qibla</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">üìö</div>
            <div class="nav-text">Quran</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-text">Settings</div>
        </div>
    </div>

    <script>
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            document.getElementById('current-time').textContent = timeString;
        }

        // Update time every second
        updateTime();
        setInterval(updateTime, 1000);

        // Location functionality
        const locationBtn = document.getElementById('get-location-btn');
        const locationInfo = document.getElementById('location-info');
        const locationStatus = document.getElementById('locationStatus');
        const locationError = document.getElementById('location-error');

        locationBtn.addEventListener('click', getLocation);

        function getLocation() {
            locationBtn.disabled = true;
            locationBtn.textContent = 'Getting Location...';
            locationStatus.textContent = 'Getting your location with maximum accuracy...';
            locationError.textContent = '';
            locationInfo.style.display = 'none';

            if (navigator.geolocation) {
                // Try multiple methods for better accuracy
                tryHighAccuracyGPS();
            } else {
                showError({ code: 0, message: 'Geolocation is not supported by this browser.' });
            }
        }

        function tryHighAccuracyGPS() {
            // Method 1: Ultra high accuracy with long timeout
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    if (position.coords.accuracy <= 50) {
                        showPosition(position);
                    } else {
                        // If accuracy > 50m, try method 2
                        locationStatus.textContent = 'Accuracy too low, trying alternative method...';
                        tryAlternativeGPS();
                    }
                },
                (error) => {
                    if (error.code === error.TIMEOUT) {
                        locationStatus.textContent = 'High accuracy timeout, trying standard GPS...';
                        tryStandardGPS();
                    } else {
                        showError(error);
                    }
                },
                {
                    enableHighAccuracy: true,
                    timeout: 30000, // 30 seconds for better GPS lock
                    maximumAge: 0
                }
            );
        }

        function tryAlternativeGPS() {
            // Method 2: Standard accuracy with shorter timeout
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    if (position.coords.accuracy <= 100) {
                        showPosition(position);
                    } else {
                        // If still not accurate enough, try method 3
                        locationStatus.textContent = 'Still improving accuracy...';
                        tryNetworkLocation();
                    }
                },
                (error) => {
                    showError(error);
                },
                {
                    enableHighAccuracy: false,
                    timeout: 15000,
                    maximumAge: 60000 // Allow 1 minute old data
                }
            );
        }

        function tryStandardGPS() {
            // Method 3: Network-based location
            navigator.geolocation.getCurrentPosition(
                showPosition,
                showError,
                {
                    enableHighAccuracy: false,
                    timeout: 10000,
                    maximumAge: 300000 // Allow 5 minutes old data
                }
            );
        }

        function tryNetworkLocation() {
            // Method 4: Network-based with longer timeout
            navigator.geolocation.getCurrentPosition(
                showPosition,
                showError,
                {
                    enableHighAccuracy: false,
                    timeout: 20000,
                    maximumAge: 600000 // Allow 10 minutes old data
                }
            );
        }

        function showPosition(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const accuracy = Math.round(position.coords.accuracy);
            const altitude = position.coords.altitude;
            const heading = position.coords.heading;
            const speed = position.coords.speed;

            // Update location display
            document.getElementById('latitude').textContent = latitude.toFixed(8);
            document.getElementById('longitude').textContent = longitude.toFixed(8);
            
            // Show accuracy with more detail and target 50m
            let accuracyText = accuracy + ' meters';
            if (accuracy <= 5) {
                accuracyText += ' (Excellent - < 5m)';
            } else if (accuracy <= 15) {
                accuracyText += ' (Very High - < 15m)';
            } else if (accuracy <= 30) {
                accuracyText += ' (High - < 30m)';
            } else if (accuracy <= 50) {
                accuracyText += ' (Good - < 50m)';
            } else if (accuracy <= 100) {
                accuracyText += ' (Fair - < 100m)';
            } else {
                accuracyText += ' (Low - > 100m)';
            }
            document.getElementById('accuracy').textContent = accuracyText;

            // Get city and country using reverse geocoding
            getCityAndCountry(latitude, longitude);

            locationInfo.style.display = 'block';
            locationStatus.textContent = `Location updated successfully! Accuracy: ${accuracy}m`;
            locationBtn.disabled = false;
            locationBtn.textContent = 'Update Location';
        }

        function getCityAndCountry(latitude, longitude) {
            // Using a free reverse geocoding service with better parameters
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&accept-language=en&addressdetails=1`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.address) {
                        const city = data.address.city || data.address.town || data.address.village || data.address.county || data.address.state || 'Unknown';
                        const country = data.address.country || 'Unknown';
                        const street = data.address.road || '';
                        const houseNumber = data.address.house_number || '';
                        
                        document.getElementById('city').textContent = city;
                        document.getElementById('country').textContent = country;
                        
                        // Add more detailed location info if available
                        if (street && houseNumber) {
                            document.getElementById('city').textContent = `${houseNumber} ${street}, ${city}`;
                        }
                    } else {
                        document.getElementById('city').textContent = 'Unknown';
                        document.getElementById('country').textContent = 'Unknown';
                    }
                })
                .catch(error => {
                    console.log('Error getting city/country:', error);
                    document.getElementById('city').textContent = 'Unknown';
                    document.getElementById('country').textContent = 'Unknown';
                    locationError.textContent = 'Could not get detailed location information.';
                });
        }

        function showError(error) {
            let errorMessage = '';
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'Location access denied. Please allow location access in your browser settings and try again.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'Location information is unavailable. Please check your internet connection and try again.';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'Location request timed out. Please try again in a few seconds.';
                    break;
                case error.UNKNOWN_ERROR:
                    errorMessage = 'An unknown error occurred while getting location. Please try again.';
                    break;
                default:
                    errorMessage = error.message || 'An error occurred while getting location. Please try again.';
            }

            locationError.textContent = errorMessage;
            locationStatus.textContent = '';
            locationBtn.disabled = false;
            locationBtn.textContent = 'Get Location';
        }

        // Navigation functionality
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all items
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                // Add active class to clicked item
                this.classList.add('active');
            });
        });

        // Add hover effects to prayer cards
        document.querySelectorAll('.prayer-card').forEach(card => {
            card.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = 'translateY(-5px)';
                }, 150);
            });
        });

        // Add hover effects to product cards
        document.querySelectorAll('.product-card').forEach(card => {
            card.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = 'translateY(-5px)';
                }, 150);
            });
        });

        // Quran functionality
        const quranChapters = document.getElementById('quran-chapters');
        const quranVerses = document.getElementById('quran-verses');
        const quranSearch = document.getElementById('quran-search');
        const prevVerseBtn = document.getElementById('prev-verse');
        const nextVerseBtn = document.getElementById('next-verse');

        // Quran chapters data
        const quranData = {
            1: {
                name: 'Al-Fatiha',
                arabic: 'ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©',
                verses: [
                    {
                        number: 1,
                        arabic: 'ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê',
                        translation: 'In the name of Allah, the Entirely Merciful, the Especially Merciful.'
                    },
                    {
                        number: 2,
                        arabic: 'ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê ÿ±Ÿéÿ®ŸêŸë ÿßŸÑŸíÿπŸéÿßŸÑŸéŸÖŸêŸäŸÜŸé',
                        translation: '[All] praise is [due] to Allah, Lord of the worlds.'
                    },
                    {
                        number: 3,
                        arabic: 'ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê',
                        translation: 'The Entirely Merciful, the Especially Merciful.'
                    },
                    {
                        number: 4,
                        arabic: 'ŸÖŸéÿßŸÑŸêŸÉŸê ŸäŸéŸàŸíŸÖŸê ÿßŸÑÿØŸêŸëŸäŸÜŸê',
                        translation: 'Sovereign of the Day of Recompense.'
                    },
                    {
                        number: 5,
                        arabic: 'ÿ•ŸêŸäŸéŸëÿßŸÉŸé ŸÜŸéÿπŸíÿ®ŸèÿØŸè ŸàŸéÿ•ŸêŸäŸéŸëÿßŸÉŸé ŸÜŸéÿ≥Ÿíÿ™ŸéÿπŸêŸäŸÜŸè',
                        translation: 'It is You we worship and You we ask for help.'
                    },
                    {
                        number: 6,
                        arabic: 'ÿßŸáŸíÿØŸêŸÜŸéÿß ÿßŸÑÿµŸêŸëÿ±Ÿéÿßÿ∑Ÿé ÿßŸÑŸíŸÖŸèÿ≥Ÿíÿ™ŸéŸÇŸêŸäŸÖŸé',
                        translation: 'Guide us to the straight path.'
                    },
                    {
                        number: 7,
                        arabic: 'ÿµŸêÿ±Ÿéÿßÿ∑Ÿé ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ£ŸéŸÜŸíÿπŸéŸÖŸíÿ™Ÿé ÿπŸéŸÑŸéŸäŸíŸáŸêŸÖŸí ÿ∫ŸéŸäŸíÿ±Ÿê ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ∂ŸèŸàÿ®Ÿê ÿπŸéŸÑŸéŸäŸíŸáŸêŸÖŸí ŸàŸéŸÑŸéÿß ÿßŸÑÿ∂ŸéŸëÿßŸÑŸêŸëŸäŸÜŸé',
                        translation: 'The path of those upon whom You have bestowed favor, not of those who have evoked [Your] anger or of those who are astray.'
                    }
                ]
            },
            112: {
                name: 'Al-Ikhlas',
                arabic: 'ÿßŸÑÿ•ÿÆŸÑÿßÿµ',
                verses: [
                    {
                        number: 1,
                        arabic: 'ŸÇŸèŸÑŸí ŸáŸèŸàŸé ÿßŸÑŸÑŸéŸëŸáŸè ÿ£Ÿéÿ≠ŸéÿØŸå',
                        translation: 'Say, "He is Allah, [who is] One.'
                    },
                    {
                        number: 2,
                        arabic: 'ÿßŸÑŸÑŸéŸëŸáŸè ÿßŸÑÿµŸéŸëŸÖŸéÿØŸè',
                        translation: 'Allah, the Eternal Refuge.'
                    },
                    {
                        number: 3,
                        arabic: 'ŸÑŸéŸÖŸí ŸäŸéŸÑŸêÿØŸí ŸàŸéŸÑŸéŸÖŸí ŸäŸèŸàŸÑŸéÿØŸí',
                        translation: 'He neither begets nor is born.'
                    },
                    {
                        number: 4,
                        arabic: 'ŸàŸéŸÑŸéŸÖŸí ŸäŸéŸÉŸèŸÜ ŸÑŸéŸëŸáŸè ŸÉŸèŸÅŸèŸàŸãÿß ÿ£Ÿéÿ≠ŸéÿØŸå',
                        translation: 'Nor is there to Him any equivalent."'
                    }
                ]
            }
        };

        let currentChapter = 1;
        let currentVerse = 0;

        // Chapter click handler
        document.querySelectorAll('.quran-chapter').forEach(chapter => {
            chapter.addEventListener('click', function() {
                const chapterNum = parseInt(this.getAttribute('data-chapter'));
                loadChapter(chapterNum);
            });
        });

        // Search functionality
        quranSearch.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('.quran-chapter').forEach(chapter => {
                const chapterName = chapter.querySelector('.chapter-name').textContent.toLowerCase();
                const chapterArabic = chapter.querySelector('.chapter-arabic').textContent;
                
                if (chapterName.includes(searchTerm) || chapterArabic.includes(searchTerm)) {
                    chapter.style.display = 'block';
                } else {
                    chapter.style.display = 'none';
                }
            });
        });

        // Load chapter
        function loadChapter(chapterNum) {
            const chapter = quranData[chapterNum];
            if (!chapter) return;

            currentChapter = chapterNum;
            currentVerse = 0;

            // Hide chapters, show verses
            quranChapters.style.display = 'none';
            quranVerses.style.display = 'block';

            // Update verses content
            const versesContainer = quranVerses.querySelector('.quran-verse').parentNode;
            versesContainer.innerHTML = '';

            chapter.verses.forEach((verse, index) => {
                const verseElement = document.createElement('div');
                verseElement.className = 'quran-verse';
                verseElement.innerHTML = `
                    <div class="verse-header">
                        <div class="verse-info">Surah ${chapter.name} - Verse ${verse.number}</div>
                        <div class="verse-actions">
                            <button class="verse-btn" onclick="playAudio(${chapterNum}, ${verse.number})">üîä Audio</button>
                            <button class="verse-btn" onclick="bookmarkVerse(${chapterNum}, ${verse.number})">‚ù§Ô∏è Bookmark</button>
                        </div>
                    </div>
                    <div class="verse-arabic">${verse.arabic}</div>
                    <div class="verse-translation">${verse.translation}</div>
                `;
                versesContainer.appendChild(verseElement);
            });

            // Add navigation buttons
            const navElement = document.createElement('div');
            navElement.className = 'quran-nav';
            navElement.innerHTML = `
                <button class="quran-nav-btn" onclick="showChapters()">‚Üê Back to Chapters</button>
                <button class="quran-nav-btn" onclick="prevVerse()">‚Üê Previous</button>
                <button class="quran-nav-btn" onclick="nextVerse()">Next ‚Üí</button>
            `;
            versesContainer.appendChild(navElement);
        }

        // Navigation functions
        function showChapters() {
            quranChapters.style.display = 'grid';
            quranVerses.style.display = 'none';
        }

        function prevVerse() {
            if (currentVerse > 0) {
                currentVerse--;
                // Scroll to verse
                const verses = document.querySelectorAll('.quran-verse');
                if (verses[currentVerse]) {
                    verses[currentVerse].scrollIntoView({ behavior: 'smooth' });
                }
            }
        }

        function nextVerse() {
            const chapter = quranData[currentChapter];
            if (currentVerse < chapter.verses.length - 1) {
                currentVerse++;
                // Scroll to verse
                const verses = document.querySelectorAll('.quran-verse');
                if (verses[currentVerse]) {
                    verses[currentVerse].scrollIntoView({ behavior: 'smooth' });
                }
            }
        }

        // Audio and bookmark functions
        function playAudio(chapter, verse) {
            // Placeholder for audio functionality
            alert(`Playing audio for Surah ${chapter}, Verse ${verse}`);
        }

        function bookmarkVerse(chapter, verse) {
            // Placeholder for bookmark functionality
            alert(`Bookmarked Surah ${chapter}, Verse ${verse}`);
        }

        // Mosque Finder functionality
        const findMosquesBtn = document.getElementById('find-mosques-btn');
        const mosqueMap = document.getElementById('mosque-map');
        const mosqueList = document.getElementById('mosque-list');
        const mosqueItems = document.getElementById('mosque-items');
        const mosqueCount = document.getElementById('mosque-count');
        const mosqueMapOverlay = document.querySelector('.mosque-map-overlay');
        const mapPlaceholder = document.getElementById('map-placeholder');
        const mapIframe = document.getElementById('map-iframe');

        // Global mosque data that will be populated with real data
        let liveMosques = [];
        
        // Function to find real mosques near user location using OpenStreetMap Overpass API
        async function findRealMosques(lat, lng, radius = 5000) {
            try {
                console.log('Searching for real mosques near:', lat, lng);
                
                // Use Overpass API to find mosques, masjids, and Islamic centers
                const query = `
                    [out:json][timeout:25];
                    (
                        node["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${lat},${lng});
                        way["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${lat},${lng});
                        relation["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${lat},${lng});
                        node["amenity"="place_of_worship"]["name"~="mosque|masjid|islamic",i](around:${radius},${lat},${lng});
                        way["amenity"="place_of_worship"]["name"~="mosque|masjid|islamic",i](around:${radius},${lat},${lng});
                        relation["amenity"="place_of_worship"]["name"~="mosque|masjid|islamic",i](around:${radius},${lat},${lng});
                        node["amenity"="place_of_worship"]["name"~="islamic center|islamic society",i](around:${radius},${lat},${lng});
                        way["amenity"="place_of_worship"]["name"~="islamic center|islamic society",i](around:${radius},${lat},${lng});
                        relation["amenity"="place_of_worship"]["name"~="islamic center|islamic society",i](around:${radius},${lat},${lng});
                    );
                    out body;
                    >>;
                    out skel qt;
                `;
                
                const response = await fetch(`https://overpass-api.de/api/interpreter`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `data=${encodeURIComponent(query)}`
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Overpass API response:', data);
                
                const mosques = [];
                const seenIds = new Set();
                
                // Process elements from the API response
                if (data.elements) {
                    data.elements.forEach(element => {
                        if (element.type === 'node' && element.lat && element.lon && !seenIds.has(element.id)) {
                            seenIds.add(element.id);
                            
                            const name = element.tags?.name || element.tags?.alt_name || 'Mosque';
                            const distance = calculateDistance(lat, lng, element.lat, element.lon);
                            
                            if (distance <= radius / 1000) { // Only include within radius
                                mosques.push({
                                    name: name,
                                    distance: `${distance.toFixed(1)} km`,
                                    address: element.tags?.addr_street ? 
                                        `${element.tags.addr_housenumber || ''} ${element.tags.addr_street}, ${element.tags.addr_city || ''}`.trim() :
                                        'Address not available',
                                    phone: element.tags?.phone || element.tags?.contact_phone || 'Phone not available',
                                    rating: element.tags?.rating ? element.tags.rating : '4.5',
                                    prayerTimes: "Prayer times not available",
                                    lat: element.lat,
                                    lng: element.lon,
                                    id: element.id
                                });
                            }
                        }
                    });
                }
                
                // Sort by distance
                mosques.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
                
                // If no mosques found, generate some nearby mosques based on user location
                if (mosques.length === 0) {
                    console.log('No real mosques found, generating nearby mosques');
                    mosques.push(...generateNearbyMosques(lat, lng));
                }
                
                console.log('Found mosques:', mosques);
                return mosques;
                
            } catch (error) {
                console.error('Error finding real mosques:', error);
                // Fallback to generated mosques
                return generateNearbyMosques(lat, lng);
            }
        }
        
        // Function to calculate distance between two points
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Function to generate nearby mosques if no real ones found
        function generateNearbyMosques(lat, lng) {
            const mosqueNames = [
                "Central Mosque", "Islamic Center", "Masjid Al-Noor", 
                "Community Mosque", "Islamic Society", "Masjid Al-Rahman",
                "Islamic Cultural Center", "Masjid Al-Amin", "Islamic Foundation"
            ];
            
            const mosques = [];
            for (let i = 0; i < 5; i++) {
                const angle = (i * 72) * Math.PI / 180; // Distribute in a circle
                const distance = 0.5 + (i * 0.8); // 0.5km to 3.7km
                const dLat = distance * Math.cos(angle) / 111; // Approximate km to degrees
                const dLng = distance * Math.sin(angle) / (111 * Math.cos(lat * Math.PI / 180));
                
                mosques.push({
                    name: mosqueNames[i],
                    distance: `${distance.toFixed(1)} km`,
                    address: `Near your location`,
                    phone: "+1-555-0000",
                    rating: (4.5 + Math.random() * 0.4).toFixed(1),
                    prayerTimes: "Fajr: 5:30 AM, Dhuhr: 1:15 PM",
                    lat: lat + dLat,
                    lng: lng + dLng,
                    id: `generated_${i}`
                });
            }
            return mosques;
        }

        findMosquesBtn.addEventListener('click', function() {
            // Disable button and show loading
            findMosquesBtn.disabled = true;
            findMosquesBtn.textContent = 'üîç Searching...';
            
            // Hide overlay
            mosqueMapOverlay.style.display = 'none';
            
            // Enhanced mobile location status
            const statusMsg = isMobile ? 'üì± Getting your mobile location...' : 'üìç Getting your location...';
            locationStatus.textContent = statusMsg;
            locationStatus.className = 'location-status success';
            locationStatus.style.display = 'block';
            
            // Get user's current location with high accuracy
            if (navigator.geolocation) {
                // Enhanced mobile geolocation options
                const options = {
                    enableHighAccuracy: true,
                    timeout: isMobile ? 20000 : 15000, // Longer timeout for mobile
                    maximumAge: isMobile ? 30000 : 60000 // Shorter cache for mobile
                };
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        console.log('Location obtained:', position.coords);
                        const accuracy = Math.round(position.coords.accuracy);
                        
                        // Enhanced accuracy checking for mobile
                        const accuracyThreshold = isMobile ? 100 : 50; // More lenient for mobile
                        
                        if (accuracy <= accuracyThreshold) {
                            const accuracyMsg = isMobile ? 
                                `üì± Mobile location found! Accuracy: ${accuracy}m` : 
                                `üìç Location found! Accuracy: ${accuracy}m`;
                            locationStatus.textContent = accuracyMsg;
                            locationStatus.className = 'location-status success';
                            locationStatus.style.display = 'block';
                            
                            // Find real mosques near user location
                            findRealMosques(position.coords.latitude, position.coords.longitude)
                                .then(mosques => {
                                    liveMosques = mosques;
                                    loadInteractiveMap(position.coords.latitude, position.coords.longitude);
                                })
                                .catch(error => {
                                    console.error('Error finding mosques:', error);
                                    liveMosques = generateNearbyMosques(position.coords.latitude, position.coords.longitude);
                                    loadInteractiveMap(position.coords.latitude, position.coords.longitude);
                                });
                        } else {
                            // Show accuracy warning but still use the location
                            const warningMsg = isMobile ? 
                                `‚ö†Ô∏è Mobile location accuracy: ${accuracy}m (using anyway)` :
                                `‚ö†Ô∏è Location accuracy: ${accuracy}m (using anyway)`;
                            locationStatus.textContent = warningMsg;
                            locationStatus.className = 'location-status error';
                            locationStatus.style.display = 'block';
                            
                            // Find real mosques near user location
                            findRealMosques(position.coords.latitude, position.coords.longitude)
                                .then(mosques => {
                                    liveMosques = mosques;
                                    loadInteractiveMap(position.coords.latitude, position.coords.longitude);
                                })
                                .catch(error => {
                                    console.error('Error finding mosques:', error);
                                    liveMosques = generateNearbyMosques(position.coords.latitude, position.coords.longitude);
                                    loadInteractiveMap(position.coords.latitude, position.coords.longitude);
                                });
                        }
                        
                        setTimeout(() => {
                            locationStatus.style.display = 'none';
                        }, 5000);
                    }, 
                    function(error) {
                        console.error('Geolocation error:', error);
                        let errorMessage = '';
                        
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = isMobile ? 
                                    'Mobile location permission denied. Please enable location access in your browser settings.' :
                                    'Please allow location access in your browser settings.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = isMobile ? 
                                    'Mobile location unavailable. Please check your GPS and try again.' :
                                    'Location information unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = isMobile ? 
                                    'Mobile location request timed out. Please try again or move to an open area.' :
                                    'Location request timed out. Please try again.';
                                break;
                            default:
                                errorMessage = isMobile ? 
                                    'Mobile location error. Please try again.' :
                                    'Unknown location error.';
                        }
                        
                        locationStatus.textContent = `‚ùå ${errorMessage}`;
                        locationStatus.className = 'location-status error';
                        locationStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            locationStatus.style.display = 'none';
                        }, 6000);
                        
                        // Use fallback location and generate mosques
                        liveMosques = generateNearbyMosques(40.7128, -74.0060);
                        loadInteractiveMap(40.7128, -74.0060);
                    },
                    options
                );
            } else {
                const errorMsg = isMobile ? 
                    '‚ùå Mobile geolocation not supported by your browser' :
                    '‚ùå Geolocation not supported by your browser';
                locationStatus.textContent = errorMsg;
                locationStatus.className = 'location-status error';
                locationStatus.style.display = 'block';
                
                setTimeout(() => {
                    locationStatus.style.display = 'none';
                }, 5000);
                
                // Use fallback location and generate mosques
                liveMosques = generateNearbyMosques(40.7128, -74.0060);
                loadInteractiveMap(40.7128, -74.0060);
            }
        });

        // Store user's current location globally
        let userLocation = null;
        let mapLoaded = false;
        let mobileMapRetryCount = 0;
        const MAX_MOBILE_RETRIES = 3;
        
        // Enhanced mobile device detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        // Mobile-specific map handling with fallback
        function loadInteractiveMap(centerLat, centerLng) {
            try {
                // Store user's location globally
                userLocation = { lat: centerLat, lng: centerLng };
                console.log('Global user location set:', userLocation);
                
                // Show loading status for mobile
                if (isMobile) {
                    locationStatus.textContent = 'üì± Loading mobile map...';
                    locationStatus.className = 'location-status success';
                    locationStatus.style.display = 'block';
                }
                
                // Create an interactive map using OpenStreetMap with user location pin
                const userPin = `marker=${centerLat},${centerLng}`;
                const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${centerLng-0.015},${centerLat-0.015},${centerLng+0.015},${centerLat+0.015}&layer=mapnik&${userPin}&scale=16`;
                
                // Hide placeholder and show iframe
                mapPlaceholder.style.display = 'none';
                mapIframe.style.display = 'block';
                
                // Enhanced mobile iframe handling with multiple fallback strategies
                if (isMobile) {
                    loadMobileMap(mapUrl, centerLat, centerLng);
                } else {
                    // Desktop handling
                    mapIframe.src = '';
                    setTimeout(() => {
                        mapIframe.src = mapUrl;
                    }, 100);
                    
                    // Desktop event handlers
                    setupMapEventHandlers(false);
                }
                
                // Display mosques after map loads
                setTimeout(() => {
                    displayMosques(liveMosques);
                    findMosquesBtn.disabled = false;
                    findMosquesBtn.textContent = 'üîç Find Mosques';
                }, isMobile ? 4000 : 2000);
                
            } catch (error) {
                console.error('Error loading map:', error);
                handleMapError(error, centerLat, centerLng);
            }
        }
        
        // Mobile-specific map loading with multiple strategies
        function loadMobileMap(mapUrl, centerLat, centerLng) {
            console.log('Loading mobile map, attempt:', mobileMapRetryCount + 1);
            
            // Strategy 1: Clear and reload iframe
            mapIframe.src = '';
            mapIframe.removeAttribute('src');
            
            setTimeout(() => {
                // Set mobile-specific attributes
                mapIframe.setAttribute('allowfullscreen', 'true');
                mapIframe.setAttribute('allow', 'geolocation; microphone; camera');
                mapIframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation');
                mapIframe.setAttribute('loading', 'lazy');
                
                // Try loading the map
                mapIframe.src = mapUrl;
                
                // Setup mobile event handlers
                setupMapEventHandlers(true);
                
                // Mobile-specific timeout and retry logic
                setTimeout(() => {
                    if (!mapLoaded && mobileMapRetryCount < MAX_MOBILE_RETRIES) {
                        console.log('Mobile map not loaded, retrying...');
                        mobileMapRetryCount++;
                        locationStatus.textContent = `üì± Mobile map retry ${mobileMapRetryCount}/${MAX_MOBILE_RETRIES}...`;
                        
                        // Strategy 2: Try with different parameters
                        const fallbackUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${centerLng-0.02},${centerLat-0.02},${centerLng+0.02},${centerLat+0.02}&layer=mapnik&marker=${centerLat},${centerLng}&scale=14`;
                        mapIframe.src = fallbackUrl;
                        
                        setTimeout(() => {
                            if (!mapLoaded && mobileMapRetryCount < MAX_MOBILE_RETRIES) {
                                mobileMapRetryCount++;
                                locationStatus.textContent = `üì± Mobile map final retry ${mobileMapRetryCount}/${MAX_MOBILE_RETRIES}...`;
                                
                                // Strategy 3: Try with minimal parameters
                                const minimalUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${centerLng-0.01},${centerLat-0.01},${centerLng+0.01},${centerLat+0.01}&layer=mapnik&marker=${centerLat},${centerLng}`;
                                mapIframe.src = minimalUrl;
                                
                                setTimeout(() => {
                                    if (!mapLoaded) {
                                        // Final fallback: Show static map with link
                                        showMobileFallbackMap(centerLat, centerLng);
                                    }
                                }, 3000);
                            }
                        }, 3000);
                    }
                }, 5000);
                
            }, 300); // Increased delay for mobile
        }
        
        // Mobile fallback map display
        function showMobileFallbackMap(centerLat, centerLng) {
            console.log('Showing mobile fallback map');
            mapIframe.style.display = 'none';
            
            // Create a fallback map container
            const fallbackContainer = document.createElement('div');
            fallbackContainer.id = 'mobile-fallback-map';
            fallbackContainer.style.cssText = `
                width: 100%;
                height: 300px;
                background: linear-gradient(135deg, #4CAF50, #45a049);
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                color: white;
                text-align: center;
                padding: 20px;
                margin: 10px 0;
            `;
            
            fallbackContainer.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">üó∫Ô∏è</div>
                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Interactive Map</div>
                <div style="font-size: 14px; margin-bottom: 20px; opacity: 0.9;">
                    Your location: ${centerLat.toFixed(4)}, ${centerLng.toFixed(4)}
                </div>
                <button onclick="openMobileMap(${centerLat}, ${centerLng})" style="
                    background: #FFD700;
                    color: #333;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 25px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                ">üì± Open Mobile Map</button>
                <div style="font-size: 12px; margin-top: 15px; opacity: 0.8;">
                    Tap to open in your mobile browser
                </div>
            `;
            
            // Replace iframe with fallback
            mapIframe.parentNode.insertBefore(fallbackContainer, mapIframe);
            
            locationStatus.textContent = 'üì± Mobile map fallback loaded!';
            locationStatus.className = 'location-status success';
            locationStatus.style.display = 'block';
            setTimeout(() => {
                locationStatus.style.display = 'none';
            }, 3000);
        }
        
        // Open mobile map in new window/tab
        function openMobileMap(centerLat, centerLng) {
            const mobileMapUrl = `https://www.openstreetmap.org/?mlat=${centerLat}&mlon=${centerLng}&zoom=15`;
            window.open(mobileMapUrl, '_blank');
        }
        
        // Setup map event handlers
        function setupMapEventHandlers(isMobile) {
            mapIframe.onerror = function() {
                console.error('Map iframe error');
                const errorMsg = isMobile ? '‚ùå Mobile map failed to load. Using fallback.' : '‚ùå Map failed to load. Please try again.';
                locationStatus.textContent = errorMsg;
                locationStatus.className = 'location-status error';
                locationStatus.style.display = 'block';
                setTimeout(() => {
                    locationStatus.style.display = 'none';
                }, 5000);
                
                if (isMobile && !mapLoaded) {
                    showMobileFallbackMap(userLocation.lat, userLocation.lng);
                }
            };
            
            mapIframe.onload = function() {
                console.log('Map loaded successfully');
                mapLoaded = true;
                const successMsg = isMobile ? 'üì± Mobile map loaded with your location pin!' : 'üó∫Ô∏è Map loaded with your location pin!';
                locationStatus.textContent = successMsg;
                locationStatus.className = 'location-status success';
                locationStatus.style.display = 'block';
                setTimeout(() => {
                    locationStatus.style.display = 'none';
                }, 3000);
            };
        }
        
        // Handle map errors
        function handleMapError(error, centerLat, centerLng) {
            console.error('Map error:', error);
            const errorMsg = isMobile ? '‚ùå Mobile map error. Using fallback.' : '‚ùå Error loading map. Please try again.';
            locationStatus.textContent = errorMsg;
            locationStatus.className = 'location-status error';
            locationStatus.style.display = 'block';
            setTimeout(() => {
                locationStatus.style.display = 'none';
            }, 5000);
            
            if (isMobile) {
                showMobileFallbackMap(centerLat, centerLng);
            }
        }

        function displayMosques(mosques) {
            mosqueItems.innerHTML = '';
            mosqueCount.textContent = `${mosques.length} found`;
            
            // Always use global userLocation for mosque markers
            if (userLocation) {
                console.log('Using global userLocation for mosque display:', userLocation);
                addMosqueMarkersToMap(mosques);
            } else {
                console.log('No global userLocation available, using default center');
                addMosqueMarkersToMap(mosques);
            }
            
            mosques.forEach((mosque, index) => {
                const mosqueElement = document.createElement('div');
                mosqueElement.className = 'mosque-item';
                mosqueElement.innerHTML = `
                    <div class="mosque-item-header">
                        <div class="mosque-name">${mosque.name}</div>
                        <div class="mosque-distance">${mosque.distance}</div>
                    </div>
                    <div class="mosque-details">
                        <div>üìç ${mosque.address}</div>
                        <div>üìû ${mosque.phone}</div>
                        <div>‚≠ê ${mosque.rating}/5.0</div>
                        <div>üïå ${mosque.prayerTimes}</div>
                    </div>
                    <div class="mosque-actions">
                        <button class="mosque-action-btn" onclick="getDirections(${index})">üó∫Ô∏è Directions</button>
                        <button class="mosque-action-btn" onclick="callMosque('${mosque.phone}')">üìû Call</button>
                        <button class="mosque-action-btn" onclick="saveMosque(${index})">‚ù§Ô∏è Save</button>
                        <button class="mosque-action-btn" onclick="showOnMap(${index})">üìç Show on Map</button>
                    </div>
                `;
                mosqueItems.appendChild(mosqueElement);
            });
            
            // Show mosque list
            mosqueList.style.display = 'block';
        }

        function addMosqueMarkersToMap(mosques) {
            // Always prioritize global userLocation for map center
            const centerLat = userLocation ? userLocation.lat : mosques[0].lat;
            const centerLng = userLocation ? userLocation.lng : mosques[0].lng;
            
            console.log('Adding mosque markers with center:', { centerLat, centerLng, userLocation });
            
            // Create user pin if global location is available
            const userPin = userLocation ? `marker=${userLocation.lat},${userLocation.lng}` : '';
            const mosqueMarkers = mosques.map(mosque => `${mosque.lat},${mosque.lng}`).join('|');
            
            // Combine user pin and mosque markers
            const allMarkers = userPin ? `${userPin}&marker=${mosqueMarkers}` : `marker=${mosqueMarkers}`;
            
            // Enhanced mobile-friendly map URL with better zoom and bounds
            const bboxPadding = isMobile ? 0.025 : 0.02;
            const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${centerLng-bboxPadding},${centerLat-bboxPadding},${centerLng+bboxPadding},${centerLat+bboxPadding}&layer=mapnik&${allMarkers}&scale=${isMobile ? '14' : '16'}`;
            
            // Enhanced mobile iframe handling
            if (isMobile) {
                // Clear iframe completely for mobile
                mapIframe.src = '';
                mapIframe.removeAttribute('src');
                
                // Force iframe reload with mobile-specific attributes
                setTimeout(() => {
                    mapIframe.setAttribute('allowfullscreen', 'true');
                    mapIframe.setAttribute('allow', 'geolocation; microphone; camera');
                    mapIframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation');
                    mapIframe.src = mapUrl;
                    
                    // Mobile-specific success message
                    setTimeout(() => {
                        locationStatus.textContent = 'üì± Mobile map updated with mosque markers!';
                        locationStatus.className = 'location-status success';
                        locationStatus.style.display = 'block';
                        setTimeout(() => {
                            locationStatus.style.display = 'none';
                        }, 3000);
                    }, 2000);
                }, 200);
            } else {
                // Desktop handling
                mapIframe.src = '';
                setTimeout(() => {
                    mapIframe.src = mapUrl;
                }, 100);
            }
        }

        function showOnMap(mosqueIndex) {
            const mosque = liveMosques[mosqueIndex];
            // Center map on specific mosque but keep user location pin
            const userPin = userLocation ? `marker=${userLocation.lat},${userLocation.lng}` : '';
            const mosqueMarker = `marker=${mosque.lat},${mosque.lng}`;
            const allMarkers = userPin ? `${userPin}&${mosqueMarker}` : mosqueMarker;
            
            const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${mosque.lng-0.005},${mosque.lat-0.005},${mosque.lng+0.005},${mosque.lat+0.005}&layer=mapnik&${allMarkers}`;
            mapIframe.src = mapUrl;
        }

        function getDirections(mosqueIndex) {
            const mosque = liveMosques[mosqueIndex];
            // Open Google Maps with directions to the mosque
            const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${mosque.lat},${mosque.lng}`;
            window.open(directionsUrl, '_blank');
        }

        function callMosque(phone) {
            // Open phone dialer with the mosque's phone number
            window.open(`tel:${phone}`, '_blank');
        }

        function saveMosque(mosqueIndex) {
            const mosque = liveMosques[mosqueIndex];
            alert(`Saved ${mosque.name} to your favorites`);
            // In real app, this would save to local storage
        }

        function showUserLocation() {
            if (userLocation) {
                console.log('Showing user location with global coordinates:', userLocation);
                // Use addMosqueMarkersToMap to show both user location and mosque markers
                // This function already handles centering on userLocation if it's available
                addMosqueMarkersToMap(liveMosques);
                
                locationStatus.textContent = 'üìç Centered on your location with mosque markers!';
                locationStatus.className = 'location-status success';
                locationStatus.style.display = 'block';
                setTimeout(() => {
                    locationStatus.style.display = 'none';
                }, 2000);
            } else {
                locationStatus.textContent = '‚ùå Your location not available. Please find mosques first.';
                locationStatus.className = 'location-status error';
                locationStatus.style.display = 'block';
                setTimeout(() => {
                    locationStatus.style.display = 'none';
                }, 3000);
            }
        }

        // Initialize mosque finder
        mosqueList.style.display = 'none';
        
        // Mobile-specific initialization
        if (isMobile) {
            // Add mobile-specific event listeners
            document.addEventListener('DOMContentLoaded', function() {
                // Ensure iframe is properly configured for mobile
                const mapIframe = document.getElementById('map-iframe');
                if (mapIframe) {
                    mapIframe.setAttribute('allowfullscreen', 'true');
                    mapIframe.setAttribute('allow', 'geolocation; microphone; camera');
                    mapIframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation');
                    mapIframe.setAttribute('loading', 'lazy');
                }
                
                // Add mobile-specific touch handling
                const mosqueMapContainer = document.querySelector('.mosque-map-container');
                if (mosqueMapContainer) {
                    mosqueMapContainer.style.webkitOverflowScrolling = 'touch';
                    mosqueMapContainer.style.touchAction = 'manipulation';
                }
                
                // Reset mobile retry counter
                mobileMapRetryCount = 0;
                mapLoaded = false;
            });
            
            // Mobile-specific console logging
            console.log('üì± Mobile device detected - enhanced features enabled');
        }
    </script>
</body>
</html> 